useEffect(() => {
  if (!ticketId) return;

  setLoading(true);
  setError('');

  fetch(`http://localhost:8765/api/tickets/${ticketId}`, {
    credentials: 'include',
    headers: { 'Content-Type': 'application/json' },
  })
    .then(res => {
      if (!res.ok) throw new Error('Unauthorized or Ticket not found');
      return res.json();
    })
    .then(ticketData => {
      setTicket(ticketData);

      // Fetch customer name
      fetch(`http://localhost:8765/api/users/${ticketData.userId}`, { credentials: 'include' })
        .then(res => res.json())
        .then(user => setCustomerName(user.name))
        .catch(() => setCustomerName(`User #${ticketData.userId}`));

      // Fetch agent name
      if (ticketData.agentId) {
        fetch(`http://localhost:8765/api/users/${ticketData.agentId}`, { credentials: 'include' })
          .then(res => res.json())
          .then(agent => setAgentName(agent.name))
          .catch(() => setAgentName(`Agent #${ticketData.agentId}`));
      }

      // Fetch attachments
      fetch(`http://localhost:8765/api/attachments/ticket/${ticketData.id}`, { credentials: 'include' })
        .then(res => res.json())
        .then(files => setAttachments(files))
        .catch(() => setAttachments([]));

      // Fetch comments
      fetch(`http://localhost:8765/api/comments/ticket/${ticketData.id}`, { credentials: 'include' })
        .then(res => res.json())
        .then(comments => setComments(comments))
        .catch(() => setComments([]));

      setLoading(false);
    })
    .catch(err => {
      console.error('Error loading ticket details:', err);
      setError('Failed to load ticket.');
      setLoading(false);
    });
}, [ticketId]);



const [ticket, setTicket] = useState(null);
const [customerName, setCustomerName] = useState('');
const [agentName, setAgentName] = useState('');
const [attachments, setAttachments] = useState<string[]>([]);
const [comments, setComments] = useState<CommentType[]>([]);
const [loading, setLoading] = useState(true);
const [error, setError] = useState('');


